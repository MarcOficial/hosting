
<!DOCTYPE html><html lang="es"> <head><meta charset="UTF-8"><meta name="description" content="EkNodes Dashboard"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/png" href="/favicon.png"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><title>Servidores - EkNodes Dash</title><link rel="stylesheet" href="/_astro/index.Dl8K1Gqz.css">
<style>@keyframes fade-in{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in[data-astro-cid-x42ewtxr]{animation:fade-in .5s ease-out forwards}
</style></head> <body class="bg-slate-950 text-slate-50 min-h-screen font-[Outfit]">   <aside id="sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0 bg-slate-950/50 backdrop-blur-xl border-r border-white/5 shadow-2xl" aria-label="Sidebar"> <div class="h-full px-4 py-6 overflow-y-auto flex flex-col"> <div class="flex items-center gap-3 px-3 mb-10 group cursor-default"> <div class="w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-600 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-500/20 group-hover:scale-110 transition-transform duration-300"> <i class="fa-solid fa-cube text-white text-xl"></i> </div> <span class="text-2xl font-black whitespace-nowrap bg-gradient-to-r from-emerald-400 to-teal-400 bg-clip-text text-transparent tracking-tight">
EkNodes
</span> </div> <ul class="space-y-2 font-medium flex-1"> <li> <a href="/" class="flex items-center px-4 py-3 rounded-2xl group transition-all duration-300 text-slate-400 hover:bg-white/5 hover:text-white border border-transparent"> <div class="w-8 h-8 flex items-center justify-center rounded-lg transition-all duration-300 group-hover:bg-emerald-500/10"> <i class="fa-solid fa-house text-base transition-colors duration-300 group-hover:text-emerald-400"></i> </div> <span class="ms-3 font-semibold">Dashboard</span>  </a> </li><li> <a href="/servidores" class="flex items-center px-4 py-3 rounded-2xl group transition-all duration-300 bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 shadow-lg shadow-emerald-500/5"> <div class="w-8 h-8 flex items-center justify-center rounded-lg transition-all duration-300 bg-emerald-500/20 shadow-inner"> <i class="fa-solid fa-server text-base transition-colors duration-300 text-emerald-400"></i> </div> <span class="ms-3 font-semibold">Servidores</span> <div class="ms-auto w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.8)]"></div> </a> </li><li> <a href="/tienda" class="flex items-center px-4 py-3 rounded-2xl group transition-all duration-300 text-slate-400 hover:bg-white/5 hover:text-white border border-transparent"> <div class="w-8 h-8 flex items-center justify-center rounded-lg transition-all duration-300 group-hover:bg-emerald-500/10"> <i class="fa-solid fa-cart-shopping text-base transition-colors duration-300 group-hover:text-emerald-400"></i> </div> <span class="ms-3 font-semibold">Tienda</span>  </a> </li><li> <a href="/earn" class="flex items-center px-4 py-3 rounded-2xl group transition-all duration-300 text-slate-400 hover:bg-white/5 hover:text-white border border-transparent"> <div class="w-8 h-8 flex items-center justify-center rounded-lg transition-all duration-300 group-hover:bg-emerald-500/10"> <i class="fa-solid fa-sack-dollar text-base transition-colors duration-300 group-hover:text-emerald-400"></i> </div> <span class="ms-3 font-semibold">Ganar Coins</span>  </a> </li> </ul> <div class="mt-auto px-2"> <div class="p-4 rounded-3xl bg-emerald-500/5 border border-emerald-500/10 mb-6"> <p class="text-[10px] uppercase tracking-widest text-emerald-500/60 font-bold mb-1 ml-1"> Estado </p> <div class="flex items-center gap-2 px-1"> <div class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div> <span class="text-xs text-slate-300 font-medium">Sistemas Online</span> </div> </div> <form method="POST" action="/" class="w-full"> <input type="hidden" name="csrf_token" value="ed299e0322be37e1301e0973c4da29e6a76bb3a91b30c91dd0c08b21e4a91116"> <input type="hidden" name="action" value="logout"> <button type="submit" class="flex items-center w-full px-4 py-3 text-slate-400 transition-all duration-300 rounded-2xl group hover:bg-red-500/10 hover:text-red-400 border border-transparent hover:border-red-500/20"> <div class="w-8 h-8 flex items-center justify-center rounded-lg group-hover:bg-red-500/10 transition-colors"> <i class="fa-solid fa-right-from-bracket text-base"></i> </div> <span class="ms-3 font-semibold text-sm">Cerrar Sesión</span> </button> </form> </div> </div> </aside> <button data-drawer-target="sidebar" data-drawer-toggle="sidebar" aria-controls="sidebar" type="button" class="fixed bottom-6 right-6 z-50 inline-flex items-center p-4 text-emerald-400 bg-slate-900/80 backdrop-blur-md rounded-2xl sm:hidden shadow-2xl border border-white/10 hover:scale-110 active:scale-95 transition-all"> <span class="sr-only">Open sidebar</span> <i class="fa-solid fa-bars-staggered text-xl"></i> </button> <div class="sm:ml-64 flex flex-col min-h-screen"> <nav class="bg-slate-950/20 backdrop-blur-md border-b border-white/5 px-6 py-4 sticky top-0 z-40"> <div class="flex justify-between items-center max-w-7xl mx-auto"> <div class="flex items-center gap-4"> <!-- Breadcrumbs or Page Title placeholder --> <div class="hidden sm:flex items-center gap-2 text-sm"> <span class="text-slate-500 font-medium">Dashboard</span> <i class="fa-solid fa-chevron-right text-[10px] text-slate-600"></i> <span class="text-slate-200 font-bold capitalize">Servidores</span> </div> </div> <div class="flex items-center gap-4 sm:gap-6"> <div class="relative inline-block text-left" id="language-picker"> <button type="button" class="flex items-center gap-2 px-3 py-2 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 transition-all text-slate-300 hover:text-white" id="lang-button"> <span class="text-sm font-bold uppercase">es</span> <i class="fa-solid fa-chevron-down text-[10px] opacity-50"></i> </button> <div id="lang-dropdown" class="absolute right-0 mt-2 w-32 bg-slate-900 border border-white/10 rounded-2xl shadow-2xl backdrop-blur-xl overflow-hidden hidden z-[100]"> <div class="p-1"> <button onclick="setLanguage('es')" class="w-full text-left px-4 py-2 text-sm font-medium rounded-xl transition-colors bg-emerald-500/10 text-emerald-400"> Español </button><button onclick="setLanguage('en')" class="w-full text-left px-4 py-2 text-sm font-medium rounded-xl transition-colors text-slate-400 hover:bg-white/5 hover:text-white"> English </button> </div> </div> </div> <script>
    function setLanguage(lang) {
        document.cookie = `lang=${lang}; path=/; max-age=31536000`;
        window.location.reload();
    }

    const btn = document.getElementById("lang-button");
    const dropdown = document.getElementById("lang-dropdown");

    if (btn && dropdown) {
        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown.classList.toggle("hidden");
        });

        document.addEventListener("click", () => {
            dropdown.classList.add("hidden");
        });
    }
</script>  <div class="flex items-center gap-3"> <div class="flex items-center gap-2 bg-emerald-500/10 border border-emerald-500/20 px-4 py-2 rounded-2xl shadow-inner group"> <i class="fa-solid fa-coins text-emerald-400 group-hover:rotate-12 transition-transform"></i> <span class="text-sm font-black text-emerald-400"> 35 </span> </div> </div> <div class="h-8 w-[1px] bg-white/5 hidden sm:block"></div> <div class="flex items-center gap-3"> <div class="hidden sm:flex flex-col items-end"> <span class="text-sm text-slate-200 font-bold"> Usuario </span> <span class="text-[10px] text-slate-500 font-medium uppercase tracking-wider"> Miembro Pro </span> </div> <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-slate-800 to-slate-900 border border-white/10 flex items-center justify-center text-slate-400 hover:text-emerald-400 transition-colors cursor-pointer group shadow-lg"> <i class="fa-solid fa-user text-lg group-hover:scale-110 transition-transform"></i> </div> </div>  </div> </div> </nav> <main class="flex-1">  <main class="p-8 sm:p-12 max-w-7xl mx-auto space-y-8" data-astro-cid-x42ewtxr> <header class="flex flex-col md:flex-row md:items-center justify-between gap-6" data-astro-cid-x42ewtxr> <div data-astro-cid-x42ewtxr> <h1 class="text-4xl font-black text-white tracking-tight" data-astro-cid-x42ewtxr> Mis <span class="text-emerald-400" data-astro-cid-x42ewtxr>Servidores</span> </h1> <p class="text-slate-500 mt-2 font-medium" data-astro-cid-x42ewtxr> Gestiona y monitorea tus instancias en tiempo real. </p> </div> <a href="/servidores/nuevo" class="inline-flex items-center gap-2 px-8 py-4 bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-black rounded-2xl transition-all shadow-lg shadow-emerald-500/20 active:scale-95" data-astro-cid-x42ewtxr> <i class="fa-solid fa-plus text-lg" data-astro-cid-x42ewtxr></i> Crear Servidor </a> </header>  <div class="bg-slate-900/40 backdrop-blur-xl rounded-[2.5rem] p-20 border border-white/5 text-center relative overflow-hidden group" data-astro-cid-x42ewtxr> <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700" data-astro-cid-x42ewtxr></div> <div class="relative z-10 space-y-6" data-astro-cid-x42ewtxr> <div class="w-24 h-24 bg-slate-950/50 rounded-3xl flex items-center justify-center mx-auto border border-white/10 shadow-2xl group-hover:scale-110 transition-transform duration-500" data-astro-cid-x42ewtxr> <i class="fa-solid fa-ghost text-5xl text-emerald-500/50 group-hover:text-emerald-400 transition-colors" data-astro-cid-x42ewtxr></i> </div> <div class="space-y-2" data-astro-cid-x42ewtxr> <h2 class="text-3xl font-black text-slate-200" data-astro-cid-x42ewtxr> Sin Servidores </h2> <p class="text-slate-500 max-w-sm mx-auto font-medium" data-astro-cid-x42ewtxr> Aún no tienes ninguna instancia creada. ¡Comienza creando tu primer servidor ahora! </p> </div> <div class="pt-4" data-astro-cid-x42ewtxr> <a href="/servidores/nuevo" class="inline-flex items-center gap-2 px-8 py-4 bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-black rounded-2xl transition-all" data-astro-cid-x42ewtxr> Crear Primer Servidor </a> </div> </div> </div> <!-- Modal para Cambiar Plan --> <div id="planModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-sm" data-astro-cid-x42ewtxr> <div class="bg-slate-900 border border-white/10 rounded-[2.5rem] w-full max-w-2xl overflow-hidden shadow-2xl" data-astro-cid-x42ewtxr> <div class="p-8 border-b border-white/5 flex justify-between items-center" data-astro-cid-x42ewtxr> <div data-astro-cid-x42ewtxr> <h2 class="text-2xl font-black text-white" data-astro-cid-x42ewtxr> Cambiar <span class="text-emerald-400" data-astro-cid-x42ewtxr>Plan</span> </h2> <p class="text-slate-500 text-sm font-medium" data-astro-cid-x42ewtxr> Selecciona un nuevo plan para tu servidor. Se te cobrarán las coins correspondientes. </p> </div> <button onclick="closePlanModal()" class="text-slate-500 hover:text-white transition-colors" data-astro-cid-x42ewtxr> <i class="fa-solid fa-xmark text-2xl" data-astro-cid-x42ewtxr></i> </button> </div> <div class="p-8 max-h-[60vh] overflow-y-auto space-y-4" data-astro-cid-x42ewtxr> <button onclick="updatePlan('plan-basic', 50)" class="w-full text-left bg-slate-950/50 p-6 rounded-3xl border border-white/5 hover:border-emerald-500/50 transition-all group flex items-center justify-between" data-astro-cid-x42ewtxr> <div data-astro-cid-x42ewtxr> <h3 class="text-lg font-black text-white group-hover:text-emerald-400 transition-colors" data-astro-cid-x42ewtxr> Básico </h3> <p class="text-slate-500 text-sm font-medium" data-astro-cid-x42ewtxr> Para servidores pequeños </p> <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-[11px] font-bold text-slate-400" data-astro-cid-x42ewtxr> <span data-astro-cid-x42ewtxr>2048MB RAM</span> <span data-astro-cid-x42ewtxr>100% CPU</span> <span data-astro-cid-x42ewtxr>4096MB Disk</span> <span data-astro-cid-x42ewtxr> 2 DDBB
</span> <span data-astro-cid-x42ewtxr> 1 
Alloc
</span> <span data-astro-cid-x42ewtxr> 2 
Backups
</span> </div> </div> <div class="text-right" data-astro-cid-x42ewtxr> <span class="block text-xl font-black text-white" data-astro-cid-x42ewtxr> 50 </span> <span class="block text-[10px] font-black text-slate-500 uppercase" data-astro-cid-x42ewtxr>
Coins
</span> </div> </button><button onclick="updatePlan('plan-standard', 100)" class="w-full text-left bg-slate-950/50 p-6 rounded-3xl border border-white/5 hover:border-emerald-500/50 transition-all group flex items-center justify-between" data-astro-cid-x42ewtxr> <div data-astro-cid-x42ewtxr> <h3 class="text-lg font-black text-white group-hover:text-emerald-400 transition-colors" data-astro-cid-x42ewtxr> Estándar </h3> <p class="text-slate-500 text-sm font-medium" data-astro-cid-x42ewtxr> Equilibrio entre coste y recursos </p> <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-[11px] font-bold text-slate-400" data-astro-cid-x42ewtxr> <span data-astro-cid-x42ewtxr>4096MB RAM</span> <span data-astro-cid-x42ewtxr>200% CPU</span> <span data-astro-cid-x42ewtxr>8192MB Disk</span> <span data-astro-cid-x42ewtxr> 3 DDBB
</span> <span data-astro-cid-x42ewtxr> 1 
Alloc
</span> <span data-astro-cid-x42ewtxr> 3 
Backups
</span> </div> </div> <div class="text-right" data-astro-cid-x42ewtxr> <span class="block text-xl font-black text-white" data-astro-cid-x42ewtxr> 100 </span> <span class="block text-[10px] font-black text-slate-500 uppercase" data-astro-cid-x42ewtxr>
Coins
</span> </div> </button><button onclick="updatePlan('plan-pro', 200)" class="w-full text-left bg-slate-950/50 p-6 rounded-3xl border border-white/5 hover:border-emerald-500/50 transition-all group flex items-center justify-between" data-astro-cid-x42ewtxr> <div data-astro-cid-x42ewtxr> <h3 class="text-lg font-black text-white group-hover:text-emerald-400 transition-colors" data-astro-cid-x42ewtxr> Pro </h3> <p class="text-slate-500 text-sm font-medium" data-astro-cid-x42ewtxr> Mayor rendimiento para servidores activos </p> <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-[11px] font-bold text-slate-400" data-astro-cid-x42ewtxr> <span data-astro-cid-x42ewtxr>6144MB RAM</span> <span data-astro-cid-x42ewtxr>300% CPU</span> <span data-astro-cid-x42ewtxr>12288MB Disk</span> <span data-astro-cid-x42ewtxr> 4 DDBB
</span> <span data-astro-cid-x42ewtxr> 2 
Alloc
</span> <span data-astro-cid-x42ewtxr> 4 
Backups
</span> </div> </div> <div class="text-right" data-astro-cid-x42ewtxr> <span class="block text-xl font-black text-white" data-astro-cid-x42ewtxr> 200 </span> <span class="block text-[10px] font-black text-slate-500 uppercase" data-astro-cid-x42ewtxr>
Coins
</span> </div> </button><button onclick="updatePlan('plan-business', 400)" class="w-full text-left bg-slate-950/50 p-6 rounded-3xl border border-white/5 hover:border-emerald-500/50 transition-all group flex items-center justify-between" data-astro-cid-x42ewtxr> <div data-astro-cid-x42ewtxr> <h3 class="text-lg font-black text-white group-hover:text-emerald-400 transition-colors" data-astro-cid-x42ewtxr> Business </h3> <p class="text-slate-500 text-sm font-medium" data-astro-cid-x42ewtxr> Alto consumo de recursos </p> <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-[11px] font-bold text-slate-400" data-astro-cid-x42ewtxr> <span data-astro-cid-x42ewtxr>8192MB RAM</span> <span data-astro-cid-x42ewtxr>400% CPU</span> <span data-astro-cid-x42ewtxr>16384MB Disk</span> <span data-astro-cid-x42ewtxr> 6 DDBB
</span> <span data-astro-cid-x42ewtxr> 3 
Alloc
</span> <span data-astro-cid-x42ewtxr> 6 
Backups
</span> </div> </div> <div class="text-right" data-astro-cid-x42ewtxr> <span class="block text-xl font-black text-white" data-astro-cid-x42ewtxr> 400 </span> <span class="block text-[10px] font-black text-slate-500 uppercase" data-astro-cid-x42ewtxr>
Coins
</span> </div> </button><button onclick="updatePlan('plan-enterprise', 600)" class="w-full text-left bg-slate-950/50 p-6 rounded-3xl border border-white/5 hover:border-emerald-500/50 transition-all group flex items-center justify-between" data-astro-cid-x42ewtxr> <div data-astro-cid-x42ewtxr> <h3 class="text-lg font-black text-white group-hover:text-emerald-400 transition-colors" data-astro-cid-x42ewtxr> Enterprise </h3> <p class="text-slate-500 text-sm font-medium" data-astro-cid-x42ewtxr> Máxima capacidad disponible </p> <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-[11px] font-bold text-slate-400" data-astro-cid-x42ewtxr> <span data-astro-cid-x42ewtxr>16384MB RAM</span> <span data-astro-cid-x42ewtxr>500% CPU</span> <span data-astro-cid-x42ewtxr>32768MB Disk</span> <span data-astro-cid-x42ewtxr> 8 DDBB
</span> <span data-astro-cid-x42ewtxr> 3 
Alloc
</span> <span data-astro-cid-x42ewtxr> 8 
Backups
</span> </div> </div> <div class="text-right" data-astro-cid-x42ewtxr> <span class="block text-xl font-black text-white" data-astro-cid-x42ewtxr> 600 </span> <span class="block text-[10px] font-black text-slate-500 uppercase" data-astro-cid-x42ewtxr>
Coins
</span> </div> </button> </div> </div> </div> <!-- Modal para Crear Subdominio --> <div id="subdomainModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-sm" data-astro-cid-x42ewtxr> <div class="bg-slate-900 border border-white/10 rounded-[2.5rem] w-full max-w-lg overflow-hidden shadow-2xl" data-astro-cid-x42ewtxr> <div class="p-8 border-b border-white/5 flex justify-between items-center" data-astro-cid-x42ewtxr> <div data-astro-cid-x42ewtxr> <h2 class="text-2xl font-black text-white" data-astro-cid-x42ewtxr> Crear <span class="text-purple-400" data-astro-cid-x42ewtxr>Subdominio</span> </h2> <p class="text-slate-500 text-sm font-medium" data-astro-cid-x42ewtxr> Asigna una IP personalizada a tu servidor de Minecraft. </p> </div> <button onclick="closeSubdomainModal()" class="text-slate-500 hover:text-white transition-colors" data-astro-cid-x42ewtxr> <i class="fa-solid fa-xmark text-2xl" data-astro-cid-x42ewtxr></i> </button> </div> <div class="p-8 space-y-6" data-astro-cid-x42ewtxr> <div class="space-y-2" data-astro-cid-x42ewtxr> <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest" data-astro-cid-x42ewtxr> Nombre del Subdominio </label> <div class="flex items-center bg-slate-950/50 border border-white/10 rounded-2xl focus-within:border-purple-500/50 transition-colors" data-astro-cid-x42ewtxr> <input type="text" id="subdomainInput" placeholder="mi-servidor" class="w-full bg-transparent text-white p-4 outline-none font-bold" data-astro-cid-x42ewtxr> <span class="pr-4 text-slate-500 font-mono text-sm" data-astro-cid-x42ewtxr>.eknodes.es</span> </div> <p class="text-xs text-slate-600" data-astro-cid-x42ewtxr> Solo letras, números y guiones. Se creará un registro SRV. </p> </div> <button onclick="createSubdomain()" class="w-full py-4 bg-purple-600 hover:bg-purple-500 text-white font-black rounded-2xl shadow-lg shadow-purple-600/20 active:scale-95 transition-all flex items-center justify-center gap-2" data-astro-cid-x42ewtxr> <i class="fa-solid fa-magic-wand-sparkles" data-astro-cid-x42ewtxr></i> Crear Subdominio </button> </div> </div> </div> </main> <div id="server-msgs" class="hidden" data-confirm-delete="¿Estás seguro de que quieres borrar este servidor? Esta acción no se puede deshacer. Se te reembolsarán {coins} monedas." data-success-delete="Servidor borrado con éxito." data-error-renew="No se pudo renovar el servidor" data-error-delete="No se pudo borrar el servidor" data-error-conn="Error de Conexión" data-confirm-subdomain="¿Estás seguro de que quieres crear el subdominio {name}.eknodes.es? Te costará 50 coins." data-creating="Creando..." data-write-name="Escribe un nombre." data-confirm-delete-subdomain="¿Estás seguro de que quieres eliminar el subdominio {name}.eknodes.es?" data-confirm-plan="¿Quieres cambiar al plan {name}? Se te cobrarán {coins} coins." data-error-plan="No se pudo cambiar el plan" data-astro-cid-x42ewtxr></div>  </main> </div>   <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script>  </body></html>  <script>
    // ... (existing renewServer, deleteServer scripts)

    const getCookie = (name) => {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
    };

    async function renewServer(serverId) {
        const msgs = document.getElementById("server-msgs").dataset;
        try {
            const response = await fetch("/api/renew-server", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRF-Token": getCookie("ek_csrf"),
                },
                body: JSON.stringify({ serverId }),
            });

            if (response.ok) {
                window.location.reload();
            } else {
                const data = await response.json();
                alert("Error: " + (data.error || msgs.errorRenew));
            }
        } catch (err) {
            console.error(err);
            alert(msgs.errorConn);
        }
    }

    async function deleteServer(serverId, refundAmount) {
        const msgs = document.getElementById("server-msgs").dataset;
        if (!confirm(msgs.confirmDelete.replace("{coins}", refundAmount))) {
            return;
        }

        try {
            const response = await fetch("/api/delete-server", {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRF-Token": getCookie("ek_csrf"),
                },
                body: JSON.stringify({ serverId }),
            });

            const data = await response.json();
            if (response.ok) {
                alert(data.message || msgs.successDelete);
                window.location.reload();
            } else {
                alert("Error: " + (data.error || msgs.errorDelete));
            }
        } catch (err) {
            console.error(err);
            alert(msgs.errorConn);
        }
    }

    let currentEditingServerId = null;

    function openPlanModal(serverId, currentPlanId) {
        currentEditingServerId = serverId;
        document.getElementById("planModal").classList.remove("hidden");
    }

    function closePlanModal() {
        document.getElementById("planModal").classList.add("hidden");
        currentEditingServerId = null;
    }

    // Modal de Subdominios
    let currentSubdomainServerId = null;

    function openSubdomainModal(serverId) {
        currentSubdomainServerId = serverId;
        document.getElementById("subdomainModal").classList.remove("hidden");
        document.getElementById("subdomainInput").value = "";
        document.getElementById("subdomainInput").focus();
    }

    function closeSubdomainModal() {
        document.getElementById("subdomainModal").classList.add("hidden");
        currentSubdomainServerId = null;
    }

    async function createSubdomain() {
        const msgs = document.getElementById("server-msgs").dataset;
        const subdomain = document
            .getElementById("subdomainInput")
            .value.trim();
        if (!subdomain) return alert(msgs.writeName);

        if (!confirm(msgs.confirmSubdomain.replace("{name}", subdomain))) {
            return;
        }

        // Deshabilitar botón para evitar doble click
        const btn = document.querySelector("#subdomainModal button");
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> ${msgs.creating}`;

        try {
            const response = await fetch("/api/create-subdomain", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRF-Token": getCookie("ek_csrf"),
                },
                body: JSON.stringify({
                    serverId: currentSubdomainServerId,
                    subdomain: subdomain,
                }),
            });

            const data = await response.json();
            if (response.ok) {
                alert(data.message);
                closeSubdomainModal();
                window.location.reload(); // Recargar para actualizar monedas
            } else {
                alert("Error: " + (data.error || "Falló la creación"));
            }
        } catch (e) {
            alert(msgs.errorConn);
        } finally {
            btn.disabled = false;
            btn.innerHTML = originalText;
        }
    }

    async function deleteSubdomain(serverId, subdomainName) {
        const msgs = document.getElementById("server-msgs").dataset;
        if (
            !confirm(
                msgs.confirmDeleteSubdomain.replace("{name}", subdomainName),
            )
        ) {
            return;
        }

        try {
            const response = await fetch("/api/delete-subdomain", {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRF-Token": getCookie("ek_csrf"),
                },
                body: JSON.stringify({ serverId }),
            });

            const data = await response.json();
            if (response.ok) {
                alert(data.message);
                window.location.reload();
            } else {
                alert("Error: " + (data.error || "Falló la eliminación"));
            }
        } catch (e) {
            alert(msgs.errorConn);
        }
    }

    // Cerrar modales al hacer click fuera
    window.addEventListener("click", (e) => {
        if (e.target.id === "planModal") closePlanModal();
        if (e.target.id === "subdomainModal") closeSubdomainModal();
    });

    async function updatePlan(planId, coins) {
        const msgs = document.getElementById("server-msgs").dataset;
        if (
            !confirm(
                msgs.confirmPlan
                    .replace("{name}", planId)
                    .replace("{coins}", coins),
            )
        ) {
            return;
        }

        try {
            const response = await fetch("/api/update-plan", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRF-Token": getCookie("ek_csrf"),
                },
                body: JSON.stringify({
                    serverId: currentEditingServerId,
                    planId,
                }),
            });

            if (response.ok) {
                window.location.reload();
            } else {
                const data = await response.json();
                alert("Error: " + (data.error || "No se pudo cambiar el plan"));
            }
        } catch (err) {
            console.error(err);
            alert("Error de conexión");
        }
    }
</script>
